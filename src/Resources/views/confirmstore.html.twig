{% extends "@ContaoCore/Backend/be_page.html.twig" %}

{% block headline %}
    {{ title }}
{% endblock %}

{% block error %}
{% endblock %}

{% block main %}
    <style>
        .barcodepackagingslip .amount_to_paid {
            font-weight: bold;
            color: red;
        }
        .barcodepackagingslip .order_paid {
            color: green;
        }
        .barcodepackagingslip .order_not_paid {
            color: red;
        }
    </style>
    <div class="tl_listing_container barcodepackagingslip">
        {%  if messages %}{{ messages|raw }}{%  endif %}
        {% if packagingSlip %}
            <div class="widget">
                <table cellspacing="0" cellpadding="0" border="0" style="width: 100%;">
                    <tr>
                        <th style="width: 20%;">{{ lang.shipping_id.0 }}</th>
                        <td>{{ shippingMethod.label }}</td>
                    </tr>
                    <tr>
                        <th style="width: 20%;">{{ lang.order_id.0 }}</th>
                        <td>{{ packagingSlip.orderDocumentNumbers }}</td>
                    </tr>
                    <tr>
                        <th style="width: 20%;">{{ lang.status.0 }}</th>
                        <td>{{ packagingSlip.statusLabel }}</td>
                    </tr>
                    <tr>
                        <th style="width: 20%;"></th>
                        <td><br/>{{ packagingSlip.generateAddress|raw }}</td>
                    </tr>
                    <tr>
                        <th style="width: 20%;"></th>
                        <td><br />
                            {% set amount_to_paid = 0.00 %}
                            {% for order in orders %}
                                {% if not order.paid %}
                                    {% set amount_to_paid = amount_to_paid + order.total %}
                                    <p class="order_not_paid">{{ 'IsotopePackagingSlipBarcodeScannerBundle.OrderNotPaid'|trans({'%s': order.document_number}, 'contao_default') }}</p>
                                {% else %}
                                    <p class="order_paid">{{ 'IsotopePackagingSlipBarcodeScannerBundle.OrderPaid'|trans({'%s': order.document_number}, 'contao_default') }}</p>
                                {% endif %}
                            {% endfor %}
                            {% if amount_to_paid > 0.00 %}
                                <p class="amount_to_paid">{{ 'IsotopePackagingSlipBarcodeScannerBundle.AmountToPaid'|trans({'%s': amount_to_paid}, 'contao_default') }}</p>
                            {% endif %}
                        </td>
                    </tr>
                </table>

                <br/><br/>

                <table cellspacing="0" cellpadding="0" border="0" style="width: 100%;">
                    <tr>
                        <th style="width: 10%; text-align: left;">
                            <strong>{{ lang_msc.PackageSlipProductIdSku }}</strong></th>
                        <th style="width: 80%; text-align: left;">
                            <strong>{{ lang_msc.PackageSlipProductIdName }}</strong></th>
                        <th style="width: 10%; text-align: right;">
                            <strong>{{ lang_msc.PackageSlipProductIdQuantity }}</strong></th>
                    </tr>
                    {% for product in packagingSlip.productsCombinedByProductId %}
                        <tr>
                            <td style="width: 20%;">{{ product.product.sku }}</td>
                            <td>{{ product.product.name }}</td>
                            <td style="width: 20%; text-align: right;">{{ product.quantity }}</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        {% endif %}

        {{ form_start(form) }}
        {{ form_errors(form) }}

        <fieldset class="tl_tbox nolegend">
            <div class="widget">
                <h3>{{ form_label(form.document_number) }}</h3>
                {{ form_widget(form.document_number) }}
            </div>
        </fieldset>

        <div class="clear"></div>
        <div class="tl_formbody_submit">
            <div class="tl_submit_container">
                {{ form_row(form.save) }}
            </div>
        </div>

        {{ form_end(form) }}
    </div>
    <script type="text/javascript">
      jQuery(document).ready(function () {
        jQuery('#form_document_number').val('');
        jQuery('#form_document_number').focus();
        jQuery('#form_document_number').keypress(function(event) {
          if (event.keyCode == 13) {
            jQuery('form[name=form]').submit();
          }
        });
      });
    </script>
{% endblock %}